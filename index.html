<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>React IMS & POS System</title>
    <meta name="theme-color" content="#3b82f6">
    <link rel="manifest" href="./manifest.json">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script>
      tailwind.config = {
        darkMode: 'class',
        theme: {
          extend: {
            fontFamily: {
              sans: ['Inter', 'sans-serif'],
            },
            colors: {
              primary: {
                50: '#eff6ff', 100: '#dbeafe', 200: '#bfdbfe', 300: '#93c5fd',
                400: '#60a5fa', 500: '#3b82f6', 600: '#2563eb', 700: '#1d4ed8',
                800: '#1e40af', 900: '#1e3a8a', 950: '#172554',
              },
            }
          },
        },
      }
    </script>
    <script>
      // Global variable to hold the prompt event
      window.deferredPrompt = null;

      window.addEventListener('beforeinstallprompt', (e) => {
        // Prevent the mini-infobar from appearing on mobile
        e.preventDefault();
        // Stash the event so it can be triggered later.
        window.deferredPrompt = e;
        console.log("beforeinstallprompt fired and captured.");
        // Dispatch a custom event to notify React components
        window.dispatchEvent(new Event('deferred-prompt-ready'));
      });

      // Helper to show a Tailwind-styled toast
      function showOfflineToast(message, isUpdate = false) {
        const toast = document.createElement('div');
        toast.className = `fixed bottom-5 right-5 ${isUpdate ? 'bg-blue-600' : 'bg-gray-800'} text-white px-6 py-3 rounded-lg shadow-xl z-[9999] transition-all duration-500 opacity-0 translate-y-10 flex items-center gap-3`;
        toast.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 ${isUpdate ? 'text-white' : 'text-green-400'}" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg><span class="font-medium">${message}</span>`;
        document.body.appendChild(toast);
        
        requestAnimationFrame(() => {
            toast.classList.remove('opacity-0', 'translate-y-10');
        });

        setTimeout(() => {
            toast.classList.add('opacity-0', 'translate-y-10');
            setTimeout(() => document.body.removeChild(toast), 500);
        }, 5000);
      }

      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('./sw.js').then(registration => {
            console.log('SW registered: ', registration);

            if (registration.active) {
                // SW is active
            }

            registration.onupdatefound = () => {
              const installingWorker = registration.installing;
              if (installingWorker == null) {
                return;
              }
              installingWorker.onstatechange = () => {
                if (installingWorker.state === 'installed') {
                  if (navigator.serviceWorker.controller) {
                    // New update available
                    console.log('New content is available; please refresh.');
                    showOfflineToast('New update available! Refresh to apply.', true);
                  } else {
                    // Content is cached for offline use.
                    console.log('Content is cached for offline use.');
                    showOfflineToast('Ready for offline use.');
                  }
                }
              };
            };
          }).catch(registrationError => {
            console.error('SW registration failed: ', registrationError);
          });
        });
      }
    </script>
    <style>
      @media print {
        body * {
          visibility: hidden;
        }
        .printable-area, .printable-area * {
          visibility: visible;
        }
        .printable-area {
          position: absolute;
          left: 0;
          top: 0;
          width: 100%;
          height: 100%;
          padding: 1rem;
        }
        .no-print {
            display: none !important;
        }
        .dark .printable-area {
          background-color: white !important;
          color: black !important;
        }
        .dark .printable-area * {
            color: black !important;
        }
      }
      
      /* Global styles to remove focus outlines from charts and tap highlights */
      .recharts-wrapper {
        outline: none !important;
      }
      .recharts-surface {
        outline: none !important;
      }
      * {
        -webkit-tap-highlight-color: transparent;
      }
    </style>
  <script type="importmap">
{
  "imports": {
    "react/": "https://aistudiocdn.com/react@^19.2.0/",
    "react": "https://aistudiocdn.com/react@^19.2.0",
    "recharts": "https://aistudiocdn.com/recharts@^3.4.1",
    "react-dom": "https://aistudiocdn.com/react-dom@^19.2.0",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.0/",
    "@google/genai": "https://aistudiocdn.com/@google/genai@^1.29.1",
    "dexie": "https://unpkg.com/dexie@3.2.4/dist/dexie.mjs",
    "dexie-react-hooks": "https://unpkg.com/dexie-react-hooks@1.1.7/dist/dexie-react-hooks.mjs"
  }
}
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
  <body class="bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-900 dark:to-gray-800">
    <div id="root"></div>
    <script type="module" src="/index.tsx"></script>
  </body>
</html>